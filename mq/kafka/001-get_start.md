# 1 消息队列

在高并发的应用场景中，由于来不及同步处理请求，接收到的请求往往会发生阻塞。因此，在高并发的应用场景中需要一种缓冲机制，而消息队列则可以很好的充当这个角色。消息队列通过异步处理请求来缓解系统的压力。

## 1.1 什么是消息队列

消息队列MQ是一种队列，拥有先进先出FIFO的特性，主要用于不同进程或线程之间的通信，用来处理一系列的输入请求。

消息队列采用异步通信机制。即，消息的发送者和接收者无须同时与消息队列进行数据交互，消息会一直保存在队列中华，直至被接收者读取。

## 1.2 消息队列主要的作用

* 应用解耦
* 异步处理
* 数据限流
* 消息通信

## 1.3 什么是Kafka

Kafka是由LinkedIn公司开发，主要用来收集各个业务系统和应用的指标数据来进行数据分析。后贡献给Apache社区，称为了Apache的顶级项目之一。

Kafka是一个分布式实时数据流平台，可独立部署在单台服务器上，也可以部署在多台服务器上构成集群。它提供了发布与订阅功能。

Kafka作为一个分布式消息队列系统，可以处理海量数据，在实时业务场景中配合Spark，Flink，Storm等实时计算引擎能很好的完成计算任务。同时也提供了应用接口（API），可以将主题中的数据导出到Hive仓库中。

Kafka系统的几个概念：

### 1.3.1 代理（Broker）

在Kafka集群中，一个Kafka进程（实例）被称为一个代理（Broker）节点。通常在部署分布式Kafka集群中，一台服务器上部署一个Kafka实例。

### 1.3.2 生产者（Producer）

在Kafka系统中，生产者通常被称为Producer，它将消息记录到Kafka集群指定的主题（Topic）中进行存储，同时Producer也能通过自定义算法决定将消息记录发送到哪个分区（Partition）。

### 1.3.3 消费者（Consumer）

消费者（Consumer）从Kafka集群指定的主题（Topic）中读取消息记录。在读取主题数据时，需要设置消费组名（GroupId），如果不设置，Kafka消费者会默认生成一个消费者组名称。

### 1.3.4 消费者组（Consumer Group）

消费者在读取主题数据时，通常会使用多线程来执行。而消费者组可以包含一个或多个消费者线程，并配合多分区模型会极大的提高读取数据的效率。

### 1.3.5 主题（Topic）

Kafka通过主题来区分不同业务类型的消息记录。

### 1.3.6 分区（Partition）

每一个主题可以分为一个或多个分区。在Kafka的设计中，分区是基于物理层面的，不同的分区对应着不同的数据文件。

Kafka通过分区来支持物理层面上的并发读写，以提高Kafka集群的吞吐量。

每个分区内部的消息记录是有序的，每个消息都有一个连续的偏移量序号。而在整个主题内部，多个分区之间是无序的。

一个分区只能对应一个代理节点，一个代理节点可以管理多个分区。

### 1.3.7 副本（Replication)

在Kafka系统中，每个主题Topic在创建时会指定它的副本数，默认是1。通过副本是保证集群的高可用。

### 1.3.8 记录（Record）

被实际写入到Kafka集群并且可以被消费者应有程序读取的数据，被称为记录。每条记录包含一个键，值和时间戳。

## 1.4 Kafka工作机制

Kafka作为一个消费队列系统，其核心机制就是生产者和消费者。



